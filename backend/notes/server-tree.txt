SERVER.JS - COMPLETE TREE MAP
============================

ğŸ“„ backend/src/server.js (MAIN ENTRY POINT)
â”œâ”€â”€ ğŸ”§ IMPORTS SECTION
â”‚   â”œâ”€â”€ import express from 'express';
â”‚   â”œâ”€â”€ import dotenv from 'dotenv';
â”‚   â”œâ”€â”€ import authRoutes from './routes/auth.route.js';
â”‚   â”œâ”€â”€ import userRoutes from "./routes/user.route.js"
â”‚   â”œâ”€â”€ import chatRoutes from "./routes/chat.route.js"
â”‚   â”œâ”€â”€ import { connectDb } from './lib/db.js';
â”‚   â””â”€â”€ import cookieParser from "cookie-parser"
â”‚
â”œâ”€â”€ âš™ï¸ CONFIGURATION
â”‚   â”œâ”€â”€ dotenv.config();
â”‚   â”œâ”€â”€ const app = express();
â”‚   â””â”€â”€ const PORT = process.env.PORT || 3000;
â”‚
â”œâ”€â”€ ğŸ”§ MIDDLEWARE SETUP
â”‚   â”œâ”€â”€ app.use(express.json());
â”‚   â”‚   â””â”€â”€ Parses incoming JSON payloads
â”‚   â”œâ”€â”€ app.use(express.urlencoded({ extended: true }));
â”‚   â”‚   â””â”€â”€ Parses URL-encoded bodies
â”‚   â””â”€â”€ app.use(cookieParser())
â”‚       â””â”€â”€ Parses cookies from request headers
â”‚
â”œâ”€â”€ ğŸ›£ï¸ ROUTE REGISTRATION
â”‚   â”œâ”€â”€ app.use("/api/auth", authRoutes);
â”‚   â”‚   â”œâ”€â”€ Handles: /api/auth/signup
â”‚   â”‚   â”œâ”€â”€ Handles: /api/auth/login
â”‚   â”‚   â”œâ”€â”€ Handles: /api/auth/logout
â”‚   â”‚   â”œâ”€â”€ Handles: /api/auth/onboarding
â”‚   â”‚   â””â”€â”€ Handles: /api/auth/me
â”‚   â”‚
â”‚   â”œâ”€â”€ app.use("/api/user", userRoutes)
â”‚   â”‚   â”œâ”€â”€ Handles: /api/user/ (GET - recommended users)
â”‚   â”‚   â”œâ”€â”€ Handles: /api/user/friends (GET - user's friends)
â”‚   â”‚   â”œâ”€â”€ Handles: /api/user/friend-request/:id (POST - send request)
â”‚   â”‚   â”œâ”€â”€ Handles: /api/user/friend-request/:id/accept (PUT - accept request)
â”‚   â”‚   â”œâ”€â”€ Handles: /api/user/friend-request/ (GET - incoming requests)
â”‚   â”‚   â””â”€â”€ Handles: /api/user/outgoing-friend-request (GET - outgoing requests)
â”‚   â”‚
â”‚   â””â”€â”€ app.use("/api/chat", chatRoutes)
â”‚       â””â”€â”€ Handles: /api/chat/token (GET - Stream Chat token)
â”‚
â””â”€â”€ ğŸš€ SERVER STARTUP
    â”œâ”€â”€ app.listen(PORT, () => {
    â”‚   â”œâ”€â”€ console.log(`Server is running on port ${PORT}`);
    â”‚   â””â”€â”€ connectDb()
    â”‚       â”œâ”€â”€ Connects to MongoDB using MONGO_URI
    â”‚       â”œâ”€â”€ Success: Logs connection host
    â”‚       â””â”€â”€ Error: Logs error and exits process
    â”‚
    â””â”€â”€ Server starts listening on specified port

ğŸ”— DEPENDENCY RELATIONSHIPS:
===========================

1. EXTERNAL DEPENDENCIES:
   â”œâ”€â”€ express: Web framework
   â”œâ”€â”€ dotenv: Environment variable loader
   â””â”€â”€ cookie-parser: Cookie parsing middleware

2. INTERNAL MODULE IMPORTS:
   â”œâ”€â”€ ./routes/auth.route.js â†’ Authentication endpoints
   â”œâ”€â”€ ./routes/user.route.js â†’ User management endpoints
   â”œâ”€â”€ ./routes/chat.route.js â†’ Chat functionality endpoints
   â””â”€â”€ ./lib/db.js â†’ Database connection function

3. ENVIRONMENT VARIABLES USED:
   â”œâ”€â”€ PORT: Server port (default: 3000)
   â””â”€â”€ MONGO_URI: MongoDB connection string (via connectDb)

ğŸ›¡ï¸ SECURITY FEATURES:
=====================
1. Cookie Parser: Enables secure cookie handling
2. JSON Body Parser: Validates JSON payloads
3. URL Encoded Parser: Handles form data
4. Environment Variables: Secure configuration management

ğŸ“Š REQUEST FLOW:
===============
1. HTTP Request â†’ Express App
2. Middleware Processing:
   â”œâ”€â”€ JSON parsing
   â”œâ”€â”€ URL encoding parsing
   â””â”€â”€ Cookie parsing
3. Route Matching:
   â”œâ”€â”€ /api/auth/* â†’ authRoutes
   â”œâ”€â”€ /api/user/* â†’ userRoutes
   â””â”€â”€ /api/chat/* â†’ chatRoutes
4. Controller Processing
5. Response Sent

ğŸ” DEBUGGING FEATURES:
=====================
- Server startup logging with port number
- Database connection status logging
- Error handling for database connection failures

âš¡ PERFORMANCE CONSIDERATIONS:
=============================
- Middleware order optimized for parsing
- Database connection established at startup
- Route grouping for efficient request handling
- Environment-based configuration

ğŸš¨ ERROR HANDLING:
=================
- Database connection errors trigger process exit
- Express built-in error handling for HTTP requests
- Environment variable fallbacks (PORT default)

ğŸ“‹ STARTUP CHECKLIST:
====================
â–¡ Environment variables loaded
â–¡ Express app initialized
â–¡ Middleware configured
â–¡ Routes registered
â–¡ Server listening on port
â–¡ Database connected
â–¡ All modules imported successfully 